<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de QR</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6 bg-white p-4 shadow rounded">
                <h1 class="text-center mb-4">Generador de Código QR</h1>

                <!-- Input de URL -->
                <div class="mb-3">
                    <label for="urlInput" class="form-label">Ingresa la URL</label>
                    <input type="text" id="urlInput" class="form-control" placeholder="https://example.com">
                </div>



                <!-- Selección de Estilo, Tamaño y Tipo -->
                <div class="mb-3">
                    <label  class="form-label d-block">Selecciona el Estilo</label>
                    <div id="styleSelect" class="d-flex justify-content-around flex-wrap">
                      
                    


                            <!-- Opción: Hostdime -->
                            <label class="text-center">
                                <input type="radio" name="style" value="hostdime" class="btn-check" id="styleHostdime">
                                <label for="styleHostdime" class="btn btn-outline-primary">
                                    <img src="/img/hostdime.png" alt="Hostdime" class="img-thumbnail" width="80">
                                    <div>Hostdime</div>
                                </label>
                            </label>


                        <!-- Opción:morado -->
                 

                        <label class="text-center">
                            <input type="radio" name="style" value="morado" class="btn-check" id="styleMorado">
                            <label for="styleMorado" class="btn btn-outline-primary">
                                <img src="/img/morado.png" alt="morado" class="img-thumbnail" width="80">
                                <div>Morado</div>
                            </label>
                        </label>
                        <!-- Opción: Puntos -->
                        <label class="text-center">
                            <input type="radio" name="style" value="dots" class="btn-check" id="styleDots">
                            <label for="styleDots" class="btn btn-outline-primary">
                                <img src="/img/dots.png" alt="Puntos" class="img-thumbnail" width="80">
                                <div>Puntos</div>
                            </label>
                        </label>
                
                        <!-- Opción: Cuadrados -->
                        <label class="text-center">
                            <input type="radio" name="style" value="square" class="btn-check" id="styleSquare">
                            <label for="styleSquare" class="btn btn-outline-primary">
                                <img src="/img/square.png" alt="Cuadrados" class="img-thumbnail" width="80">
                                <div>Cuadrados</div>
                            </label>
                        </label>
                
                        
                    </div>
                </div>
                




                <div class="mb-3">
                    <label class="form-label">Tamaño</label>
                    <select id="sizeSelect" class="form-select">
                        <option value="300">300</option>
                        <option value="500">500</option>
                        <option value="1200">1200</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Formato</label>
                    <select id="typeSelect" class="form-select">
                        <option value="svg">SVG</option>
                        <option value="png">PNG</option>
                    </select>
                </div>

                <!-- Botones -->
                <div class="d-grid gap-2">
                    <button class="btn btn-primary" onclick="shortURL()">Generar URL Corta</button>
                    <button class="btn btn-success" onclick="generarQR()">Generar QR</button>
                </div>

                <!-- URL corta generada -->
                <p id="shortUrl" class="mt-3 text-center text-primary fw-bold"></p>

                <!-- Imagen del QR -->
                <div class="text-center mt-3">
                    <img id="qrImage" class="img-fluid shadow-lg d-none" alt="Código QR generado">
                </div>

                <!-- Botón de descarga -->
                <div class="text-center mt-3">
                    <a id="downloadButton" class="btn btn-info d-none">Descargar QR</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>





    <script>
        function validarURL(url) {
            try {
                new URL(url);
                return true;
            } catch (e) {
                return false;
            }
        }

        async function shortURL() {
            const urlInput = document.getElementById("urlInput");
            const shortUrl = document.getElementById("shortUrl");

            if (!urlInput.value || !validarURL(urlInput.value)) {
                alert("Por favor, ingresa una URL válida.");
                return;
            }

            try {
                const response = await fetch("https://qrlink.hostdi.me/rest/v3/short-urls", {
                    method: "POST",
                    headers: {
                        "X-Api-Key": "7c24e07c7d1a-49a9-6465-937e-05e1f965",
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({ longUrl: urlInput.value })
                });

                if (!response.ok) {
                    throw new Error(`Error en la API: ${response.status}`);
                }

                const data = await response.json();
                shortUrl.textContent = `URL corta: ${data.shortUrl}`;
                shortUrl.style.display = "block";
                alert("URL acortada correctamente ✅");
            } catch (error) {
                console.error("Error:", error);
                alert("No se pudo acortar la URL.");
            }
        }

        async function generarQR() {
            const url = document.getElementById("urlInput").value;
           const style = document.querySelector('input[name="style"]:checked').value;

            const size = parseInt(document.getElementById("sizeSelect").value, 10);
            const type = document.getElementById("typeSelect").value;
            const qrImage = document.getElementById("qrImage");
            const downloadButton = document.getElementById("downloadButton");

            if (!validarURL(url)) {
                alert("Ingrese una URL válida.");
                return;
            }

            try {
                const response = await fetch("http://localhost:3000/generar-qr", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ url, style, size, type })
                });

                if (!response.ok) {
                    throw new Error("Error generando el código QR");
                }

                const blob = await response.blob();
                const qrURL = URL.createObjectURL(blob);

                qrImage.src = qrURL;
                qrImage.classList.remove("d-none");

                downloadButton.href = qrURL;
                downloadButton.download = `codigo-qr.${type}`;
                downloadButton.classList.remove("d-none");
            } catch (error) {
                console.error("Error:", error);
                alert("No se pudo generar el QR.");
            }
        }
    </script>

</body>
</html>
